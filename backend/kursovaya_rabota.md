# КУРСОВАЯ РАБОТА
## «Разработка backend для интернет-магазина цветов E-Flower-Shop»

## ВВЕДЕНИЕ

В современном мире онлайн-торговля становится всё более важной частью бизнеса. Интернет-магазины позволяют компаниям расширять свою клиентскую базу, не ограничиваясь географическим положением физических точек продаж. Одним из перспективных направлений в этой сфере является продажа цветов и букетов онлайн. 

Цветочная индустрия представляет собой динамично развивающийся сегмент рынка, который требует гибких и современных технологических решений. Особенностью данного бизнеса является работа с товарами, имеющими ограниченный срок хранения, необходимость быстрой доставки, а также высокая степень персонализации предложений для клиентов.

Настоящая курсовая работа посвящена разработке backend-части интернет-магазина цветов "E-Flower-Shop", который предоставляет полный спектр функциональных возможностей для организации онлайн-торговли цветами и букетами. Разработанное программное обеспечение позволяет управлять каталогом товаров, обрабатывать заказы, работать с пользователями и предоставлять API для интеграции с фронтенд-частью приложения.

В данной работе рассматриваются вопросы проектирования архитектуры приложения, выбора технологий и инструментов разработки, реализации функциональных требований и обеспечения безопасности системы. Также уделяется внимание особенностям бизнес-логики цветочного магазина, таким как составление букетов, учет праздников для формирования персонализированных предложений и управление отзывами пользователей.

## 1. ИССЛЕДОВАТЕЛЬСКИЙ РАЗДЕЛ

### 1.1. Назначение системы

Разрабатываемая система представляет собой серверную часть (backend) интернет-магазина цветов и букетов "E-Flower-Shop". Её назначение заключается в обеспечении всех необходимых функций для осуществления электронной коммерции в сфере продажи цветочной продукции, включая:

- Управление каталогом товаров (цветы, букеты, сопутствующие товары)
- Обработку заказов и платежей
- Управление пользователями и их персональными данными
- Предоставление API для взаимодействия с фронтенд-частью приложения
- Обеспечение безопасности и защиты данных пользователей
- Оптимизацию бизнес-процессов, специфичных для цветочного бизнеса

Система предназначена для использования как конечными пользователями (покупателями), так и администраторами магазина, которые управляют товарами, заказами и другими аспектами работы магазина через административный интерфейс.

### 1.2. Цель создания системы

Основной целью создания системы является разработка надежного, масштабируемого и безопасного backend-решения для интернет-магазина цветов, которое будет удовлетворять современным требованиям электронной коммерции и специфике цветочного бизнеса.

Дополнительными целями являются:

1. Создание гибкой архитектуры, которая позволит легко добавлять новые функциональные возможности и адаптироваться к изменяющимся требованиям бизнеса
2. Обеспечение высокой производительности системы для обработки значительного количества запросов
3. Разработка удобного и хорошо документированного API для интеграции с различными клиентскими приложениями
4. Реализация специфической бизнес-логики цветочного магазина, включая систему составления букетов, учет праздников для формирования предложений и работу с отзывами
5. Обеспечение безопасности данных пользователей и защиты системы от различных типов атак

### 1.3. Постановка задач системы

Для достижения поставленных целей необходимо решить следующие задачи:

1. Провести анализ требований и спецификаций для интернет-магазина цветов
2. Спроектировать архитектуру системы, соответствующую современным подходам к разработке веб-приложений
3. Разработать схему базы данных, учитывающую особенности предметной области
4. Реализовать основные модули системы:
   - Модуль управления товарами (продукты, цветы, букеты)
   - Модуль категорий и подкатегорий
   - Модуль управления пользователями и аутентификации
   - Модуль корзины покупок
   - Модуль обработки заказов
   - Модуль отзывов и рейтингов
   - Модуль управления файлами и изображениями
   - Административный модуль
5. Разработать и документировать REST API для взаимодействия с фронтенд-частью
6. Реализовать механизмы безопасности (аутентификация, авторизация, валидация данных)
7. Обеспечить логирование и мониторинг работы системы
8. Подготовить систему к развертыванию в производственной среде

### 1.4 Требования к системе

#### Функциональные требования:

1. **Управление товарами**:
   - Создание, чтение, обновление и удаление товаров (CRUD)
   - Управление категориями и подкатегориями
   - Поддержка различных типов товаров (цветы, букеты, сопутствующие товары)
   - Управление изображениями товаров

2. **Управление пользователями**:
   - Регистрация и аутентификация пользователей
   - Управление профилями пользователей
   - Система ролей (пользователь, администратор)
   - Управление адресами доставки
   - Сохранение праздников пользователя для персонализации

3. **Корзина и заказы**:
   - Добавление товаров в корзину
   - Управление количеством товаров в корзине
   - Оформление заказа
   - Отслеживание статуса заказа
   - История заказов пользователя

4. **Отзывы и рейтинги**:
   - Добавление отзывов к товарам
   - Рейтинговая система
   - Модерация отзывов

5. **Административные функции**:
   - Управление всеми аспектами магазина
   - Просмотр статистики и отчетов
   - Управление пользователями и заказами

#### Нефункциональные требования:

1. **Производительность**:
   - Время отклика API не более 200 мс для большинства операций
   - Способность обрабатывать не менее 100 запросов в секунду

2. **Безопасность**:
   - Защита от основных типов атак (XSS, CSRF, инъекции SQL)
   - Шифрование чувствительных данных
   - Безопасное хранение паролей
   - Защита от брутфорс-атак

3. **Масштабируемость**:
   - Архитектура, позволяющая горизонтальное масштабирование
   - Оптимизация базы данных для работы с большими объемами данных

4. **Надежность**:
   - Доступность системы не менее 99.9%
   - Корректная обработка ошибок
   - Логирование всех критических операций

5. **Удобство использования и поддержки**:
   - Хорошо документированный API
   - Логирование событий для диагностики проблем
   - Простота развертывания и обновления

### 1.5 Сроки создания системы

Разработка системы планируется в несколько этапов с общей продолжительностью 4 месяца:

1. **Этап 1: Анализ и проектирование** (2 недели)
   - Анализ требований
   - Проектирование архитектуры
   - Разработка схемы базы данных

2. **Этап 2: Разработка базовой функциональности** (4 недели)
   - Настройка среды разработки
   - Реализация базовых модулей (пользователи, товары, категории)
   - Разработка системы аутентификации

3. **Этап 3: Разработка основных бизнес-модулей** (6 недель)
   - Реализация модуля корзины и заказов
   - Разработка системы отзывов и рейтингов
   - Реализация специфической бизнес-логики (букеты, праздники)

4. **Этап 4: Безопасность и оптимизация** (2 недели)
   - Внедрение механизмов безопасности
   - Оптимизация производительности
   - Настройка логирования и мониторинга

5. **Этап 5: Тестирование и подготовка к релизу** (2 недели)
   - Тестирование всех компонентов системы
   - Исправление ошибок
   - Подготовка документации
   - Настройка процесса развертывания

### 1.6. Определение инструментов разработки системы

При выборе технологического стека для разработки backend-части интернет-магазина цветов необходимо учитывать следующие критерии:
- Соответствие требованиям проекта
- Производительность и масштабируемость
- Безопасность
- Скорость разработки
- Наличие сообщества и документации
- Простота поддержки и расширения функциональности

#### 1.6.1. Выбор языка программирования

Для разработки backend-части была выбрана платформа **Node.js** с языком программирования **JavaScript**. Данный выбор обусловлен следующими факторами:

1. **Асинхронная природа и неблокирующий ввод-вывод**: Node.js построен на основе движка V8 от Google и использует событийно-ориентированную архитектуру и неблокирующий ввод-вывод. Это делает его особенно эффективным для обработки множества одновременных соединений, что критически важно для веб-приложений с высокой нагрузкой.

2. **Единый язык для frontend и backend**: Использование JavaScript как на клиентской, так и на серверной части позволяет разработчикам легче переключаться между различными частями приложения, повышая эффективность разработки.

3. **Большая экосистема пакетов**: Node.js имеет огромную экосистему пакетов через npm (Node Package Manager), что существенно ускоряет разработку за счет готовых решений для типичных задач.

4. **Хорошая производительность**: Благодаря компиляции JavaScript в машинный код через движок V8, Node.js демонстрирует высокую производительность для большинства веб-приложений.

5. **Активное сообщество и поддержка**: Node.js имеет большое сообщество разработчиков, активную поддержку и обширную документацию, что облегчает решение возникающих проблем.

6. **Масштабируемость**: Node.js хорошо подходит для создания масштабируемых приложений благодаря своей асинхронной архитектуре и возможности горизонтального масштабирования.

Для данного проекта выбрана версия Node.js 18+, которая предоставляет современные возможности языка JavaScript, включая поддержку ECMAScript 2022, улучшенную производительность и расширенные функции безопасности.

#### 1.6.2. Выбор фреймворка

В качестве основного фреймворка для разработки backend-части был выбран **Express.js**. Этот выбор обусловлен следующими причинами:

1. **Минималистичность и гибкость**: Express.js предоставляет минимальный набор инструментов для создания веб-приложений, не навязывая жестких архитектурных решений. Это позволяет разработчикам создавать гибкие структуры приложений, адаптированные под конкретные потребности проекта.

2. **Распространенность и зрелость**: Express.js является одним из самых популярных и зрелых фреймворков для Node.js, что гарантирует его стабильность и наличие решений для большинства типичных проблем.

3. **Простота интеграции с middleware**: Express.js имеет простую и понятную систему middleware, что позволяет легко добавлять функциональность для обработки запросов (логирование, аутентификация, обработка ошибок и т.д.).

4. **Хорошая документация и большое сообщество**: Express.js обладает обширной документацией и активным сообществом разработчиков, что облегчает поиск информации и решение проблем.

5. **Производительность**: Express.js оптимизирован для построения быстрых веб-приложений с минимальными накладными расходами.

6. **Поддержка REST API**: Express.js отлично подходит для создания RESTful API с четкой структурой эндпоинтов, что соответствует требованиям проекта.

7. **Легкость тестирования**: Приложения на Express.js легко тестировать благодаря модульной структуре и возможности использования различных инструментов для автоматизированного тестирования.

Для структурирования приложения используется архитектурный подход MVC (Model-View-Controller), который хорошо сочетается с Express.js и обеспечивает четкое разделение ответственности между компонентами системы:
- **Model**: Модели для работы с данными и бизнес-логикой
- **Controller**: Контроллеры для обработки запросов и формирования ответов
- **View**: В данном случае представление данных в формате JSON для API

Такой подход облегчает поддержку и расширение функциональности приложения, а также делает код более структурированным и понятным.

### 1.7. Выбор программного обеспечения для разработки системы

#### 1.7.1. Выбор среды разработки

Для разработки backend-части проекта была выбрана интегрированная среда разработки **Visual Studio Code**. Этот выбор обусловлен следующими факторами:

1. **Кросс-платформенность**: VS Code работает на Windows, macOS и Linux, что обеспечивает единообразие среды разработки для всех участников команды, независимо от используемой операционной системы.

2. **Легковесность и быстродействие**: VS Code обладает высокой скоростью работы даже на относительно слабых компьютерах, при этом предоставляя богатый функционал.

3. **Расширяемость**: Большое количество плагинов и расширений позволяет настроить среду под конкретные задачи разработки Node.js и JavaScript.

4. **Интеграция с Git**: Встроенная поддержка систем контроля версий, в частности Git, облегчает процесс командной разработки.

5. **IntelliSense и автодополнение**: Мощные возможности автодополнения кода, особенно для JavaScript и Node.js, повышают продуктивность разработчиков.

6. **Интегрированный терминал**: Возможность запуска команд Node.js и npm непосредственно из среды разработки.

7. **Отладка**: Встроенные инструменты для отладки Node.js приложений.

Дополнительно для повышения качества кода и соблюдения единого стиля кодирования используются следующие инструменты:

- **ESLint**: Для статического анализа кода JavaScript и выявления потенциальных проблем
- **Prettier**: Для автоматического форматирования кода в соответствии с установленными правилами
- **Nodemon**: Для автоматического перезапуска сервера при изменении файлов во время разработки

#### 1.7.2. Выбор системы управления базами данных

В качестве системы управления базами данных для проекта выбрана **PostgreSQL** версии 13+. Этот выбор обоснован следующими причинами:

1. **Реляционная модель**: PostgreSQL предоставляет надежную реляционную модель, которая хорошо подходит для структурированных данных интернет-магазина (товары, категории, пользователи, заказы и т.д.).

2. **Поддержка JSON**: PostgreSQL имеет встроенную поддержку JSON и JSONB типов данных, что позволяет гибко хранить полуструктурированные данные без необходимости использования NoSQL решений.

3. **Транзакционность и ACID-совместимость**: PostgreSQL обеспечивает полную поддержку транзакций и соответствие принципам ACID (Atomicity, Consistency, Isolation, Durability), что критически важно для финансовых операций в интернет-магазине.

4. **Масштабируемость и производительность**: PostgreSQL хорошо масштабируется и оптимизирован для высокопроизводительных операций чтения и записи.

5. **Расширяемость**: PostgreSQL имеет систему расширений, что позволяет добавлять новую функциональность без изменения ядра СУБД.

6. **Поддержка индексов**: Богатый набор типов индексов (B-tree, Hash, GiST, SP-GiST, GIN, BRIN) для оптимизации различных типов запросов.

7. **Открытый исходный код и активное сообщество**: PostgreSQL имеет открытый исходный код, активно развивается и поддерживается сообществом разработчиков.

8. **Надежность и безопасность**: PostgreSQL известен своей надежностью и имеет мощные механизмы безопасности, включая шифрование данных, аутентификацию по SSL и строгую систему прав доступа.

Для взаимодействия с PostgreSQL из Node.js используется библиотека **pg** (node-postgres), которая предоставляет эффективный способ выполнения SQL-запросов и работы с результатами.

#### 1.7.3. Выбор сервера разработки системы

Для развертывания и управления приложением в производственной среде выбран менеджер процессов **PM2**. Он предоставляет следующие преимущества:

1. **Управление процессами**: PM2 позволяет запускать, останавливать и перезапускать Node.js приложения с минимальным временем простоя.

2. **Кластеризация**: Автоматическое создание кластеров Node.js для использования всех ядер процессора, что повышает производительность и отказоустойчивость.

3. **Мониторинг**: Встроенный мониторинг производительности и использования ресурсов позволяет своевременно выявлять проблемы.

4. **Логирование**: Централизованное управление логами приложения с возможностью их ротации.

5. **Автоматический перезапуск**: Приложение автоматически перезапускается при сбоях или при превышении установленных лимитов использования памяти.

6. **Интеграция с системами непрерывной интеграции**: PM2 легко интегрируется с CI/CD системами для автоматизации процесса развертывания.

7. **Управление переменными окружения**: Простое управление конфигурацией приложения через переменные окружения.

Для дополнительного удобства развертывания и изоляции приложения также используется **Docker** и **Docker Compose**. Это обеспечивает:

1. **Изоляцию окружения**: Контейнеризация приложения гарантирует, что оно будет работать одинаково в любой среде.

2. **Упрощение развертывания**: Docker позволяет упаковать приложение со всеми зависимостями в единый контейнер, который легко развернуть на любом сервере с установленным Docker.

3. **Масштабируемость**: Docker Compose облегчает управление несколькими взаимосвязанными сервисами (например, приложение, база данных, кэш и т.д.).

4. **Версионирование**: Возможность фиксировать точные версии используемых компонентов для обеспечения стабильности работы.

### 1.8 Spring Framework

В контексте разработки backend-части интернет-магазина цветов необходимо уточнить, что хотя Spring Framework является мощным и популярным инструментом для создания серверных приложений на Java, в данном проекте он не используется. Вместо этого, как описано выше, выбрана платформа Node.js с фреймворком Express.js.

Однако, стоит отметить, что некоторые архитектурные принципы и паттерны, характерные для Spring Framework, такие как:
- Инверсия управления (IoC)
- Аспектно-ориентированное программирование (AOP)
- Модульная структура
- Четкое разделение ответственности компонентов

Применяются и в разработке на Node.js, хотя и с использованием других технических средств.

В Express.js эти принципы реализуются через:
- Систему middleware для обработки запросов
- Модульную организацию маршрутов и контроллеров
- Четкое разделение бизнес-логики и доступа к данным
- Использование зависимостей через модульную систему Node.js

Такой подход к архитектуре приложения обеспечивает аналогичные преимущества: гибкость, масштабируемость, тестируемость и поддерживаемость кода.

### 1.9 Что такое http

HTTP (HyperText Transfer Protocol) - это прикладной протокол передачи данных в сети Интернет, который является основой для взаимодействия в World Wide Web. HTTP определяет, как форматируются и передаются сообщения, и какие действия должны предпринимать веб-серверы и браузеры в ответ на различные команды.

#### Основные характеристики HTTP:

1. **Клиент-серверная архитектура**: HTTP функционирует на основе парадигмы "запрос-ответ". Клиент (обычно веб-браузер) инициирует запрос к серверу, который обрабатывает его и возвращает ответ.

2. **Отсутствие состояния (Stateless)**: HTTP протокол по своей природе не сохраняет состояние между запросами. Каждый запрос от клиента к серверу содержит всю необходимую информацию для его обработки, независимо от предыдущих запросов.

3. **Расширяемость**: Протокол может быть расширен с помощью HTTP-заголовков, которые добавляют функциональность к запросам и ответам.

4. **Независимость от данных**: HTTP может передавать любой тип данных, если клиент и сервер договорились о формате (определяется с помощью MIME-типов).

#### Методы HTTP:

HTTP определяет набор методов запроса, которые указывают желаемое действие для указанного ресурса:

1. **GET**: Запрашивает представление ресурса. Запросы с использованием этого метода должны только извлекать данные и не должны иметь других последствий.

2. **POST**: Отправляет данные на сервер для создания или обновления ресурса. Часто используется для отправки форм или загрузки файлов.

3. **PUT**: Заменяет все текущие представления ресурса данными запроса.

4. **DELETE**: Удаляет указанный ресурс.

5. **PATCH**: Применяет частичные изменения к ресурсу.

6. **HEAD**: Аналогичен GET, но сервер передает только заголовки ответа без тела запроса.

7. **OPTIONS**: Используется для определения возможностей веб-сервера или параметров соединения для конкретного ресурса.

#### Коды состояния HTTP:

HTTP ответы включают трехзначный код состояния, который указывает на результат запроса:

1. **1xx (Информационные)**: Запрос получен, процесс продолжается.
2. **2xx (Успешные)**: Запрос успешно получен, понят и обработан.
   - 200 OK: Стандартный успешный ответ.
   - 201 Created: Ресурс успешно создан.
3. **3xx (Перенаправления)**: Необходимы дальнейшие действия для выполнения запроса.
   - 301 Moved Permanently: Ресурс перемещен навсегда.
   - 302 Found: Временное перенаправление.
4. **4xx (Ошибки клиента)**: Запрос содержит ошибки или не может быть выполнен.
   - 400 Bad Request: Сервер не понимает запрос.
   - 401 Unauthorized: Требуется аутентификация.
   - 403 Forbidden: Доступ запрещен.
   - 404 Not Found: Ресурс не найден.
5. **5xx (Ошибки сервера)**: Сервер не смог выполнить действительный запрос.
   - 500 Internal Server Error: Общая ошибка сервера.
   - 503 Service Unavailable: Сервер временно недоступен.

#### HTTP в контексте REST API:

В разработанном backend-приложении для интернет-магазина цветов HTTP используется как основа для создания REST API (Representational State Transfer). REST API следует принципам архитектурного стиля REST и использует HTTP методы для выполнения операций с ресурсами:

1. **GET** для получения списка товаров или детальной информации о товаре
2. **POST** для создания нового пользователя или добавления товара в корзину
3. **PUT/PATCH** для обновления данных пользователя или изменения статуса заказа
4. **DELETE** для удаления товара из корзины или отзыва

Использование HTTP в контексте REST API обеспечивает:
- Стандартизированный интерфейс между клиентом и сервером
- Масштабируемость и гибкость системы
- Независимость клиента и сервера
- Возможность кэширования ответов
- Совместимость с различными клиентскими платформами (веб, мобильные устройства)

## 2. ТЕХНОЛОГИЧЕСКИЙ РАЗДЕЛ

### 2.1 Создание проекта

Процесс создания backend-проекта для интернет-магазина цветов включал несколько этапов, начиная с инициализации проекта и настройки базовых компонентов.

#### 2.1.1 Инициализация проекта Node.js

Первым шагом было создание базовой структуры Node.js приложения с использованием npm (Node Package Manager):

```bash
mkdir e-flower-shop
cd e-flower-shop
mkdir backend
cd backend
npm init -y
```

Команда `npm init -y` создает файл `package.json` с настройками по умолчанию, который содержит метаданные проекта и список зависимостей.

#### 2.1.2 Установка необходимых зависимостей

После инициализации проекта были установлены основные зависимости, необходимые для разработки REST API:

```bash
npm install express pg bcrypt cookie-parser cors dotenv helmet multer pino uuid swagger-jsdoc swagger-ui-express
npm install --save-dev eslint nodemon
```

Основные зависимости включают:
- **express**: Веб-фреймворк для создания API
- **pg**: Драйвер для PostgreSQL
- **bcrypt**: Библиотека для хеширования паролей
- **cookie-parser**: Middleware для работы с cookies
- **cors**: Middleware для настройки Cross-Origin Resource Sharing
- **dotenv**: Загрузка переменных окружения из .env файла
- **helmet**: Middleware для защиты HTTP-заголовков
- **multer**: Middleware для загрузки файлов
- **pino**: Библиотека для логирования
- **uuid**: Генерация уникальных идентификаторов
- **swagger-jsdoc** и **swagger-ui-express**: Документирование API

Зависимости для разработки:
- **eslint**: Статический анализатор кода
- **nodemon**: Автоматический перезапуск сервера при изменении файлов

#### 2.1.3 Создание основных файлов проекта

Были созданы основные файлы проекта, включая точку входа в приложение `index.js` и главный файл сервера `server.js`.

Пример содержимого файла `server.js`:

```javascript
require('dotenv').config();
const express = require('express');
const cors = require('cors');
const helmet = require('helmet');
const path = require('path');
const logger = require('./config/logger')('server');
const routes = require('./routes');
const { swaggerUi, specs } = require('./config/swagger');
const cookieParser = require('cookie-parser');

const app = express();
const PORT = process.env.PORT || 3000;

// Middleware
app.use(helmet());
app.use(cors({
  origin: process.env.CORS_ORIGIN || 'http://localhost:3000',
  credentials: true
}));
app.use(express.json());
app.use(express.urlencoded({ extended: true }));
app.use(cookieParser());

// Логирование запросов
app.use((req, res, next) => {
  logger.info({
    method: req.method,
    url: req.url,
    ip: req.ip
  }, 'Incoming request');
  next();
});

// API документация
app.use('/api-docs', swaggerUi.serve, swaggerUi.setup(specs));

// API маршруты
app.use('/api', routes);

// Обработка ошибок
app.use((err, req, res, next) => {
  logger.error({ err }, 'Error occurred');
  res.status(500).json({
    error: 'Ошибка сервера',
    message: process.env.NODE_ENV === 'production' ? 'Произошла ошибка' : err.message
  });
});

// Запуск сервера
if (require.main === module) {
  app.listen(PORT, () => {
    logger.info(`Сервер запущен на порту ${PORT}`);
  });
}

module.exports = app;
```

#### 2.1.4 Создание файла конфигурации и переменных окружения

Для управления конфигурацией приложения был создан файл `.env` с переменными окружения:

```
# Настройки сервера
PORT=3000
NODE_ENV=development

# База данных
DB_HOST=localhost
DB_PORT=5432
DB_NAME=flower_shop
DB_USER=postgres
DB_PASSWORD=postgres

# Настройки безопасности
JWT_SECRET=your_jwt_secret_key
COOKIE_SECRET=your_cookie_secret
SESSION_EXPIRY=86400000 # 24 часа в миллисекундах

# CORS
CORS_ORIGIN=http://localhost:5173
```

#### 2.1.5 Настройка Docker для разработки

Для упрощения процесса разработки и обеспечения единообразия среды были созданы Docker-файлы:

Файл `Dockerfile`:

```Dockerfile
FROM node:18-alpine

WORKDIR /app

COPY package*.json ./

RUN npm install

COPY . .

EXPOSE 3000

CMD ["npm", "start"]
```

Файл `docker-compose.yml`:

```yaml
version: '3'
services:
  backend:
    build: .
    ports:
      - "3000:3000"
    volumes:
      - .:/app
      - /app/node_modules
    depends_on:
      - db
    environment:
      - DB_HOST=db
    command: npm run dev

  db:
    image: postgres:13
    ports:
      - "5432:5432"
    environment:
      POSTGRES_DB: flower_shop
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
    volumes:
      - postgres_data:/var/lib/postgresql/data

volumes:
  postgres_data:
```

### 2.2 Среда разработки

Для разработки backend-части интернет-магазина цветов использовалась следующая среда:

#### 2.2.1 Операционная система и инструменты

- **Операционная система**: macOS / Windows / Linux
- **IDE**: Visual Studio Code с расширениями для Node.js и JavaScript
- **Система контроля версий**: Git и GitHub для хранения и управления кодом
- **Инструменты для тестирования API**: Postman для ручного тестирования эндпоинтов

#### 2.2.2 Настройка среды разработки

Visual Studio Code был настроен с использованием следующих расширений для повышения продуктивности разработки:

- **ESLint**: Интеграция ESLint для проверки кода в реальном времени
- **Prettier**: Автоматическое форматирование кода
- **Docker**: Интеграция с Docker для управления контейнерами
- **REST Client**: Тестирование HTTP-запросов прямо из редактора
- **GitLens**: Расширенная интеграция с Git
- **JavaScript (ES6) code snippets**: Сниппеты для быстрого написания кода

#### 2.2.3 Настройка ESLint

Для обеспечения качества кода и соблюдения единого стиля программирования был настроен ESLint с базовой конфигурацией для Node.js проектов:

```json
{
  "env": {
    "node": true,
    "es2021": true
  },
  "extends": "eslint:recommended",
  "parserOptions": {
    "ecmaVersion": 2021
  },
  "rules": {
    "indent": ["error", 2],
    "linebreak-style": ["error", "unix"],
    "quotes": ["error", "single"],
    "semi": ["error", "always"]
  }
}
```

### 2.3. Определение структуры системы

Структура проекта backend-части интернет-магазина цветов организована в соответствии с принципами MVC (Model-View-Controller) и следует принципам модульности и разделения ответственности.

#### 2.3.1 Общая архитектура системы

Система построена на основе трехуровневой архитектуры:

1. **Уровень представления**: REST API эндпоинты, которые принимают HTTP-запросы и возвращают JSON-ответы
2. **Уровень бизнес-логики**: Контроллеры и сервисы, которые обрабатывают запросы и содержат бизнес-логику приложения
3. **Уровень данных**: Модели для взаимодействия с базой данных

#### 2.3.2 Структура проекта

```
backend/
├── admin/         # Панель администратора
├── config/        # Конфигурационные файлы
│   ├── db.js      # Конфигурация подключения к БД
│   ├── logger.js  # Настройка логирования
│   └── swagger.js # Конфигурация Swagger
├── controllers/   # Контроллеры для обработки запросов
│   ├── auth.js    # Контроллер аутентификации
│   ├── cart.js    # Контроллер корзины
│   ├── product.js # Контроллер товаров
│   └── ...
├── db/            # SQL-миграции и схемы
│   ├── migrations/# Миграции базы данных
│   └── seeds/     # Начальные данные
├── logs/          # Логи сервера
├── middleware/    # Промежуточные обработчики
│   ├── auth.js    # Middleware аутентификации
│   ├── error.js   # Обработка ошибок
│   └── ...
├── models/        # Модели данных
│   ├── product.js # Модель товаров
│   ├── user.js    # Модель пользователей
│   └── ...
├── public/        # Статические файлы
│   └── uploads/   # Загруженные изображения
├── routes/        # Маршруты API
│   ├── auth.js    # Маршруты аутентификации
│   ├── product.js # Маршруты товаров
│   └── ...
├── scripts/       # Скрипты для инициализации
│   ├── initDb.js  # Инициализация БД
│   └── ...
├── .dockerignore  # Игнорируемые файлы для Docker
├── .env           # Переменные окружения
├── .eslintrc.json # Конфигурация ESLint
├── .gitignore     # Игнорируемые файлы для Git
├── docker-compose.yml # Настройки Docker Compose
├── Dockerfile     # Инструкции для сборки Docker-образа
├── index.js       # Точка входа в приложение
├── package.json   # Метаданные проекта и зависимости
├── README.md      # Документация проекта
└── server.js      # Основной файл сервера
```

#### 2.3.3 Компоненты системы и их взаимодействие

Система состоит из следующих основных компонентов, которые взаимодействуют между собой:

1. **Сервер Express.js**: Обрабатывает HTTP-запросы, использует middleware для предварительной обработки запросов и маршрутизирует их к соответствующим обработчикам.

2. **Маршрутизаторы (Routers)**: Определяют URL-маршруты для API и связывают их с соответствующими контроллерами.

3. **Контроллеры (Controllers)**: Содержат логику обработки запросов, вызывают модели для работы с данными и формируют ответы.

4. **Модели (Models)**: Инкапсулируют бизнес-логику и взаимодействие с базой данных, представляют собой абстракцию над данными.

5. **Middleware**: Обеспечивают дополнительную функциональность, которая выполняется до или после обработки запроса контроллером (аутентификация, логирование, обработка ошибок и т.д.).

6. **База данных PostgreSQL**: Хранит данные приложения в реляционной структуре.

Взаимодействие компонентов происходит следующим образом:

1. Клиент отправляет HTTP-запрос на сервер
2. Сервер Express.js применяет глобальные middleware (логирование, CORS, парсинг тела запроса и т.д.)
3. Запрос перенаправляется на соответствующий маршрутизатор в зависимости от URL
4. Маршрутизатор применяет специфичные для маршрута middleware (например, проверка аутентификации)
5. Запрос передается соответствующему методу контроллера
6. Контроллер обрабатывает запрос, при необходимости используя модели для работы с данными
7. Контроллер формирует и отправляет ответ клиенту

Такая архитектура обеспечивает:
- Модульность и повторное использование кода
- Четкое разделение ответственности между компонентами
- Удобство тестирования отдельных компонентов
- Масштабируемость и гибкость системы

### 2.4. Разработка модулей системы и ее компонентов

В данном разделе будет описан процесс разработки основных модулей и компонентов backend-системы интернет-магазина цветов, их функциональные возможности и реализация.

#### 2.4.1. Разработка баз данных

Для хранения данных интернет-магазина используется реляционная база данных PostgreSQL. На этапе проектирования была разработана схема базы данных, учитывающая особенности предметной области цветочного магазина.

##### Схема базы данных

Основными таблицами в базе данных являются:

1. **users** - таблица пользователей системы
2. **sessions** - таблица пользовательских сессий
3. **categories** - таблица категорий товаров
4. **subcategories** - таблица подкатегорий товаров
5. **products** - таблица товаров
6. **flowers** - таблица цветов для составления букетов
7. **bouquet_flowers** - таблица связи букетов с цветами
8. **files** - таблица для хранения информации о файлах и изображениях
9. **cart_items** - таблица элементов корзины
10. **orders** - таблица заказов
11. **order_items** - таблица элементов заказа
12. **reviews** - таблица отзывов
13. **user_holidays** - таблица праздников пользователей для персонализации
14. **user_addresses** - таблица адресов пользователей

#### 2.4.2 Работа системы

Разработанный backend обеспечивает полноценное функционирование интернет-магазина цветов, предоставляя API для всех необходимых операций:

1. **Управление пользователями**: регистрация, аутентификация, управление профилем и адресами
2. **Управление товарами**: просмотр каталога, фильтрация по категориям, поиск
3. **Управление корзиной**: добавление, удаление и изменение количества товаров
4. **Оформление заказов**: создание и отслеживание заказов
5. **Отзывы и рейтинги**: добавление и просмотр отзывов о товарах
6. **Управление букетами**: составление букетов из отдельных цветов
7. **Административные функции**: управление всеми аспектами магазина

Система обеспечивает безопасность данных, оптимизирована для высокой производительности и имеет подробную документацию API.

## ЗАКЛЮЧЕНИЕ

В рамках данной курсовой работы был спроектирован и разработан backend для интернет-магазина цветов E-Flower-Shop. В процессе работы были решены следующие задачи:

1. Проведен анализ требований и особенностей предметной области цветочного бизнеса.
2. Спроектирована гибкая и масштабируемая архитектура приложения, основанная на современных подходах и технологиях.
3. Разработана реляционная схема базы данных, учитывающая специфику хранения и обработки данных для цветочного магазина.
4. Реализованы все необходимые модули системы, обеспечивающие полноценное функционирование интернет-магазина.
5. Обеспечена безопасность системы с использованием современных методов защиты.
6. Создано и документировано REST API для взаимодействия с фронтенд-частью приложения.
7. Реализованы механизмы логирования и мониторинга для обеспечения надежной работы системы.
8. Подготовлена система для развертывания в производственной среде с использованием Docker и PM2.

В результате выполнения курсовой работы была создана полноценная серверная часть интернет-магазина цветов, которая удовлетворяет всем функциональным и нефункциональным требованиям. Система обладает следующими ключевыми характеристиками:

- **Модульность** - четкое разделение ответственности между компонентами системы
- **Масштабируемость** - возможность горизонтального масштабирования для обработки растущей нагрузки
- **Безопасность** - защита от основных типов веб-атак и безопасное хранение чувствительных данных
- **Производительность** - оптимизация запросов к базе данных и кэширование часто используемых данных
- **Гибкость** - возможность легкого расширения функциональности и адаптации к изменяющимся требованиям

Разработанный backend полностью готов к интеграции с фронтенд-частью приложения и может быть успешно использован для создания полноценного интернет-магазина цветов с расширенной функциональностью.

В дальнейшем система может быть дополнена следующими функциональными возможностями:
- Интеграция с платежными системами
- Автоматизированная система уведомлений (email, SMS, push)
- Система лояльности с накоплением баллов и применением скидок
- Интеграция с системами доставки для автоматического расчета стоимости и отслеживания
- Аналитические инструменты для анализа продаж и поведения пользователей

Использованные в разработке технологии (Node.js, Express.js, PostgreSQL) и архитектурные решения обеспечивают хорошую основу для дальнейшего развития и расширения системы. 